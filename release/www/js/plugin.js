"use strict";angular.module("owsWalletPlugin",["gettext","ngLodash","owsWalletPluginClient","owsWalletPlugin.api","owsWalletPlugin.controllers","owsWalletPlugin.services"]),angular.module("owsWalletPlugin.api",[]),angular.module("owsWalletPlugin.controllers",[]),angular.module("owsWalletPlugin.services",[]),angular.module("owsWalletPlugin").config(function(){}).run(function($rootScope,ApiRouter,bitpayService){$rootScope.$on("$pre.ready",function(event,session){bitpayService.init(session),ApiRouter.addRoutes([{path:"/bitpay/invoices",method:"POST",handler:"createInvoice"}])})}),angular.module("owsWalletPlugin").run(["gettextCatalog",function(gettextCatalog){}]),angular.module("owsWalletPlugin.services").service("bitpayService",function($rootScope,$log){var session,root={};return $rootScope.$on("$pre.beforeLeave",function(event,servlet){saveData()}),root.data={},root.init=function(sessionObj,cb){session=sessionObj,root.servletName=session.plugin.header.name,cb()},root.getData=function(cb){cb=cb||function(){},session.get("data").then(function(value){cb(null,value)}).catch(function(error){$log.error("Failed to read preferences: "+error.message+" ("+error.statusCode+")"),cb(error)})},root.saveData=function(){session.set("data",data),session.flush()},root}),angular.module("owsWalletPlugin.api").service("createInvoice",function(lodash,CHttp){var root={},REQUIRED_PARAMS=["price","currency"];return root.respond=function(message,callback){var data=message.request.data;if(Object.keys(lodash.pick(data,REQUIRED_PARAMS)).length!=REQUIRED_PARAMS.length)return message.response={statusCode:400,statusText:"The request must include "+REQUIRED_PARAMS.toString()+".",data:{}},callback(message);new CHttp("https://bitpay.com/api/").post("/invoices",data).then(function(reponse){return message.response={statusCode:200,statusText:"OK",data:response},callback(message)}).catch(function(error){return message.response={statusCode:400,statusText:error,data:{}},callback(message)})},root});