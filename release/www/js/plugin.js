"use strict";angular.module("owsWalletPlugin",["gettext","ngLodash","owsWalletPluginClient","owsWalletPlugin.api","owsWalletPlugin.controllers","owsWalletPlugin.services"]),angular.module("owsWalletPlugin.api",[]),angular.module("owsWalletPlugin.controllers",[]),angular.module("owsWalletPlugin.services",[]),angular.module("owsWalletPlugin").config(function(){}).run(function($rootScope,ApiRouter,bitpayService){$rootScope.$on("$pre.ready",function(event,session){ApiRouter.addRoutes(session,[{path:"/bitpay/invoices",method:"POST",handler:"createInvoice"}]),bitpayService.init(session,function(){})})}),angular.module("owsWalletPlugin").run(["gettextCatalog",function(gettextCatalog){}]),angular.module("owsWalletPlugin.services").service("bitpayService",function($rootScope,apiLog){var session,root={};return $rootScope.$on("$pre.beforeLeave",function(event,servlet){saveData()}),root.data={},root.init=function(sessionObj,cb){session=sessionObj,root.servletName=session.plugin.header.name,cb()},root.getData=function(cb){cb=cb||function(){},session.get("data").then(function(value){cb(null,value)}).catch(function(error){apiLog.error("Failed to read preferences: "+error.message+" ("+error.statusCode+")"),cb(error)})},root.saveData=function(){session.set("data",data),session.flush()},root}),angular.module("owsWalletPlugin.api").service("createInvoice",function(lodash,CHttp,CSession){var root={},REQUIRED_PARAMS=["config.api.url","config.api.auth.token","data.price","data.currency"];return root.respond=function(message,callback){if(Object.keys(lodash.pick(message.request.data,REQUIRED_PARAMS)).length!=REQUIRED_PARAMS.length)return message.response={statusCode:400,statusText:"The request must include "+REQUIRED_PARAMS.toString()+".",data:{}},callback(message);var config=message.request.data.config,data=message.request.data.data;new CHttp(config.api.url).post("/invoices",data).then(function(reponse){return message.response={statusCode:200,statusText:"OK",data:response},callback(message)}).catch(function(error){return message.response={statusCode:400,statusText:error,data:{}},callback(message)})},root});